<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
          rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="../style.css" />
    <title>Личный кабинет</title>
</head>
<body>
    <div class="all d-flex justify-content-center">
        <nav class="navbar navbar-expand-lg bg-white shadow-lg p-1 mb-5 mt-3 bg-body rounded w-75 font-family-sans-serif fs-5">
            <div class="container-fluid">
                <button class="navbar-toggler"
                        data-bs-toggle="collapse"
                        data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link" href="/Main/">Главная</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/ContactPage/">Контакты</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="note.html">Заметки</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="tag.html">Теги</a>
                        </li>
                    </ul>
                </div>
                <span class="m-3"><img src="/img/clock.svg" /></span>
                <div class="lk_btn text-center p-1 w-25 h-25">
                    <input id="lk_button"
                           class="lk w-75 h-75"
                           type="submit"
                           onclick="location.href='./lk.html'"
                           style="color: white; background-color: #ad00ff"
                           value="Личный кабинет" />
                </div>
            </div>
        </nav>
    </div>
    <div class="container-fluid">
        <div class="row d-flex justify-content-center align-items-start">
            <div class="col-12 col-sm-10 col-xl-5">
                <div class="d-flex align-items-center justify-content-center m-3">
                    <img class="photo_lk" src="/img/photo_lk.png" alt="Мое фото" />
                </div>
            </div>
            <div class="col-12 col-sm-10 col-xl-5 pt-3">
                <form class="account pt-0 mt-0" name="accountForm" id="account_form" method="post">
                    <p id="message_lk" class="text-center" style="color: firebrick"></p>
                    <div class="container rounded" style="border: 2px solid #ffcc7f">
                        <div class="row">
                            <div class="show_block" style="border: 1px solid #ffcc7f">
                                <div class="show_tit fw-bold pb-2 pt-2"
                                     style="border-bottom: 1px solid #ffcc7f"
                                     id="lk_fio">
                                    ФИО
                                </div>
                                <div class="show_info pb-2 pt-2" id="linp_fio">
                                    <textarea class="form_textar"
                                              name="user_name"
                                              id="placeFio"
                                              cols="45"
                                              rows="1"></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="show_block" style="border: 1px solid #ffcc7f">
                                <div class="show_tit fw-bold pb-2 pt-2"
                                     style="border-bottom: 1px solid #ffcc7f"
                                     id="lk_data">
                                    Дата рождения
                                </div>
                                <div class="show_info pb-2 pt-2" id="linp_data">
                                    <textarea class="form_textar"
                                              name="user_birth"
                                              id="placeData"
                                              cols="45"
                                              rows="1"></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="show_block" style="border: 1px solid #ffcc7f">
                                <div class="show_tit fw-bold pb-2 pt-2"
                                     style="border-bottom: 1px solid #ffcc7f"
                                     id="lk_phone">
                                    Номер телефона
                                </div>
                                <div class="show_info pb-2 pt-2" id="linp_phone">
                                    <textarea class="form_textar"
                                              name="user_pn"
                                              id="placePhone"
                                              cols="45"
                                              rows="1"></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="show_block" style="border: 1px solid #ffcc7f">
                                <div class="show_tit fw-bold pb-2 pt-2"
                                     style="border-bottom: 1px solid #ffcc7f"
                                     id="lk_email">
                                    Адрес электронной почты
                                </div>
                                <div class="show_info pb-2 pt-2" id="linp_email">
                                    <textarea class="form_textar"
                                              name="user_email"
                                              id="placeEmail"
                                              cols="45"
                                              rows="1"></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="show_block" style="border: 1px solid #ffcc7f">
                                <div class="show_tit fw-bold pb-2 pt-2"
                                     style="border-bottom: 1px solid #ffcc7f"
                                     id="show_pass">
                                    Пароль
                                </div>
                                <div class="show_info pb-2 pt-2" id="linp_pass">
                                    <textarea class="form_textar"
                                              name="user_password"
                                              id="placePass"
                                              cols="45"
                                              rows="1"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row justify-content-around pt-5 pb-3">
                        <div class="lk_btn text-center m-2 p-2 w-50 h-25">
                            <input id="change_user_btn"
                                   type="button"
                                   style="color: white; background-color: #ad00ff"
                                   value="Редактировать" />
                        </div>
                        <div class="text-center lk_btn_form m-2 p-1 w-25 h-25" style="border: 3px solid #ad00ff; border-radius: 10px; cursor: pointer;">
                            <input id="exit_lk_btn"
                                   type="button"
                                   style="color: #ad00ff; background-color: white;"
                                   value="Выход" />
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script src="/js/AccountReq.js"></script>
    <script>
        const accountForm = document.querySelector("form.accountForm");
        function changeButtonValue() {
            const lk_button = document.getElementById("lk_button");
            if (window.innerWidth < 1140) {
                lk_button.value = "ЛК";
            } else {
                lk_button.value = "Личный кабинет";
            }
        }
        window.addEventListener("resize", changeButtonValue);
        changeButtonValue();
        GetUser();
        document.getElementById("change_user_btn").addEventListener("click", function () {
            EditUser();
            document.getElementById("message_lk").innerHTML = '';
        });
        document.getElementById("exit_lk_btn").addEventListener("click", function () {
            if (window.confirm("Вы точно хотите выйти?")) {
                window.location.href = `https://localhost:7148`;

            }
        });
        // Получение данных пользователя
        async function GetUser() {
            const response = await fetch('/User/GetUserData', {
                method: "GET",
                headers: { "Accept": "application/json" }
            });
            if (response.ok) {
                const user = await response.json();
                console.log(user);
                const form = document.forms["accountForm"];
                form.elements["user_name"].value = user.user_name;
                form.elements["user_birth"].value = user.user_birth;
                form.elements["user_pn"].value = user.user_pn;
                form.elements["user_email"].value = user.user_email;
                form.elements["user_password"].value = user.user_password;
            }
        }
        //Изменение данных пользователя
        async function EditUser() {
            const response = await fetch("/User/ChangeUserData", {
                method: "PUT",
                body: new FormData(document.forms.accountForm),
            });
            console.log(response.body);
            if (response.ok === true) {
                const user = await response.json();
                console.log(user);
            } else {
                const errorData = await response.json();
                if (errorData) {
                    // Выводим ошибки в консоль
                    console.error("Ошибки от сервера:", errorData);
                    // Выводим ошибки пользователю
                    document.getElementById("message_lk").innerHTML = errorData + "<br/>";
                } else {
                    alert("Ошибка сервера. Попробуйте позже.");
                }
            }
        }
    </script>
</body>
</html>
